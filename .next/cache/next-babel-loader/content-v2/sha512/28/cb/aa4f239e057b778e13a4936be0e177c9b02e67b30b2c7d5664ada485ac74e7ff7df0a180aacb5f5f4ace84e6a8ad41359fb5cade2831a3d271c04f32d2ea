{"ast":null,"code":"import _defineProperty from \"/Users/140457/Documents/Study/CNM/cnm-crypto-wallet/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"/Users/140457/Documents/Study/CNM/cnm-crypto-wallet/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/140457/Documents/Study/CNM/cnm-crypto-wallet/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport Axios from \"axios\";\nimport { CLIENT_ENV, envInfo } from \"src/utils/url\";\nexport var AXIOS = Axios.create({\n  withCredentials: true,\n  baseURL: envInfo[CLIENT_ENV].BASE_URL,\n  headers: {\n    \"content-type\": \"application/json\",\n    \"Access-Control-Allow-Origin\": \"*\"\n  },\n  timeout: 50000\n});\nAXIOS.interceptors.response.use(function (response) {\n  return Promise.resolve(response);\n}, /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(error) {\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (isSessionExpiredError(error)) {\n              console.log(\"error\", error);\n              localStorage.removeItem(\"id\");\n              localStorage.removeItem(\"avatar\");\n              redirectToLoginPage();\n            }\n\n            return _context.abrupt(\"return\", Promise.reject(error));\n\n          case 2:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x) {\n    return _ref.apply(this, arguments);\n  };\n}());\n\nvar isSessionExpiredError = function isSessionExpiredError(error) {\n  if (error.response && error.response.status === 401) {\n    return true;\n  }\n\n  return false;\n};\n\nexport var redirectToLoginPage = function redirectToLoginPage() {\n  if (!window) return;\n  var url = window.location.href;\n\n  if (url.indexOf(\"localhost\") !== -1) {\n    window.location.href = url.substr(0, window.location.href.indexOf(\"localhost\") + 14) + \"/login\";\n  } else {\n    window.location.href = \"/login\";\n  } // window.location.href =\n  //   (window as any).env.LOGIN_URL + encodeURIComponent(window.location.href);\n\n};\nexport var doAxiosRequestIntercept = function doAxiosRequestIntercept() {\n  AXIOS.interceptors.request.use( /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(config) {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              return _context2.abrupt(\"return\", createConfig(config));\n\n            case 1:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }(), function (error) {\n    console.log(\"errordoAxiosRequestIntercept\", error);\n    Promise.reject(error);\n  });\n};\n\nvar createConfig = /*#__PURE__*/function () {\n  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(config) {\n    var token, mConfig;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            token = localStorage.getItem(\"token\");\n            mConfig = _objectSpread(_objectSpread({}, config), {}, {\n              data: _objectSpread({}, config.data),\n              headers: {\n                Authorization: \"Bearer \".concat(token)\n              }\n            });\n            return _context3.abrupt(\"return\", mConfig);\n\n          case 3:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function createConfig(_x3) {\n    return _ref3.apply(this, arguments);\n  };\n}();","map":{"version":3,"sources":["/Users/140457/Documents/Study/CNM/cnm-crypto-wallet/src/services/api/config.ts"],"names":["Axios","CLIENT_ENV","envInfo","AXIOS","create","withCredentials","baseURL","BASE_URL","headers","timeout","interceptors","response","use","Promise","resolve","error","isSessionExpiredError","console","log","localStorage","removeItem","redirectToLoginPage","reject","status","window","url","location","href","indexOf","substr","doAxiosRequestIntercept","request","config","createConfig","token","getItem","mConfig","data","Authorization"],"mappings":"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","sourcesContent":["import Axios, { AxiosError, AxiosResponse } from \"axios\";\nimport { CLIENT_ENV, envInfo } from \"src/utils/url\";\n\nexport let AXIOS = Axios.create({\n  withCredentials: true,\n  baseURL: envInfo[CLIENT_ENV].BASE_URL,\n  headers: {\n    \"content-type\": \"application/json\",\n    \"Access-Control-Allow-Origin\": \"*\",\n  },\n  timeout: 50000,\n});\n\nAXIOS.interceptors.response.use(\n  (response: AxiosResponse<any>): Promise<AxiosResponse<any>> => {\n    return Promise.resolve(response);\n  },\n  async (error: AxiosError<any>): Promise<AxiosResponse<any>> => {\n    if (isSessionExpiredError(error)) {\n      console.log(\"error\", error);\n      localStorage.removeItem(\"id\");\n      localStorage.removeItem(\"avatar\");\n      redirectToLoginPage();\n    }\n    return Promise.reject(error);\n  }\n);\n\nconst isSessionExpiredError = (error: AxiosError<any>): boolean => {\n  if (error.response && error.response.status === 401) {\n    return true;\n  }\n  return false;\n};\n\nexport const redirectToLoginPage = () => {\n  if (!window) return;\n  const url = window.location.href;\n  if (url.indexOf(\"localhost\") !== -1) {\n    window.location.href =\n      url.substr(0, window.location.href.indexOf(\"localhost\") + 14) + \"/login\";\n  } else {\n    window.location.href = \"/login\";\n  }\n\n  // window.location.href =\n  //   (window as any).env.LOGIN_URL + encodeURIComponent(window.location.href);\n};\n\nexport const doAxiosRequestIntercept = () => {\n  AXIOS.interceptors.request.use(\n    async (config) => {\n      return createConfig(config);\n    },\n    (error) => {\n      console.log(\"errordoAxiosRequestIntercept\", error);\n      Promise.reject(error);\n    }\n  );\n};\n\nconst createConfig = async (config: any) => {\n  const token = localStorage.getItem(\"token\");\n  const mConfig = {\n    ...config,\n    data: {\n      ...config.data,\n    },\n    headers: {\n      Authorization: `Bearer ${token}`,\n    },\n  };\n  return mConfig;\n};\n"]},"metadata":{},"sourceType":"module"}